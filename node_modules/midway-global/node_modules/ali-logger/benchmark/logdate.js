/*!
 * logger - benchmark/logdate.js
 * Copyright(c) 2013 fengmk2 <fengmk2@gmail.com>
 * MIT Licensed
 */

"use strict";

/**
 * Module dependencies.
 */

var fs = require('fs-extra');
var logger = require('../');
var Benchmark = require('benchmark');
var suite = new Benchmark.Suite();

var logdir = __dirname + '/.logs';
fs.removeSync(logdir);
logger.init({
  logdir: logdir,
  accessLog: true,
});

var query = '{"sql":"SELECT brand_id AS id, brand_name AS name FROM myfox.dim_brand WHERE brand_id IN (:ids)","data":{"ids":["20841","102438674"]}}';

suite

.add('logger.info("ITier200:%s %s %s %s:%s", use, query, rows.length, tablename, use)', function () {
  logger.info("ITier200:%s %s %s %s:%s", 123123, query, 10, 'myfox.dim_brand', 123123);
})
.add('logger.warn("ITier200:%s %s %s %s:%s", use, query, rows.length, tablename, use)', function () {
  logger.warn("ITier200:%s %s %s %s:%s", 123123, query, 10, 'myfox.dim_brand', 123123);
})
.add("logger.accessLog('172.168.2.100', 1000000, 'OPTIONS', '/foo/bar/food', 302, 888, '-', 'hsf')", function () {
  logger.accessLog('172.168.2.100', 1000000, 'OPTIONS', '/foo/bar/food', 302, 888, '-', 'hsf');
})
.add('ignore info level: logger.info("ITier200:%s %s %s %s:%s", use, query, rows.length, tablename, use)', function () {
  logger.setLevel(logger.WARN);
  logger.info("ITier200:%s %s %s %s:%s", 123123, query, 10, 'myfox.dim_brand', 123123);
  logger.setLevel(logger.INFO);
})

// add listeners
.on('cycle', function (event) {
  console.log(String(event.target));
})
.on('complete', function () {
  console.log('Fastest is ' + this.filter('fastest').pluck('name'));
  logger.end();
})
.run({ async: false });
