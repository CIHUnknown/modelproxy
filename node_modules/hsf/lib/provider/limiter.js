/*!
 * hsf - provider/limiter.js
 * Copyright(c) 2012 Taobao.com
 * Author: busi.hyy <busi.hyy@taobao.com>
 */


/**
 * Limiter
 * 
 * @param  {Number} rate, target TPS.
 * @param  {Number} peak, peak limit.
 * @param  {Number} window, refresh time window. Default 1000, 1s.
 */
var Limiter = function(rate, peak, window) {
  this.rate = rate;
  this.peak = peak > rate ? peak : rate;
  this.token = rate;
  this.window = window || 1000;
  this.timer = setInterval(this.refresh.bind(this), this.window);
};

Limiter.prototype.refresh = function() {
  var token = this.token + Math.floor(this.rate * this.window / 1000);
  this.token = token < this.peak ? token : this.peak;
};

Limiter.createLimiter = function(rate, peak, window) {
  return new Limiter(rate, peak, window);
};

module.exports = Limiter;
