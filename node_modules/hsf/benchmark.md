## benchmark result  

----   

### 测试环境  
#### 机器  
client: Intel(R) Xeon(R) CPU           E5620  @ 2.40GHz  
server: Intel(R) Xeon(R) CPU           E5620  @ 2.40GHz  

### 测试报告概况   

#### http hello world   
input: `siege -t 100S -c 50 --benchmark http://10.232.102.134:8080/`  
output:  

```
QPS: 9919
RT: 0.01s
```
input: `siege -t 100S -c 100 --benchmark http://10.232.102.134:8080/`  
output:  

```
QPS: 10856
RT: 0.01s
```

#### hsf ping echo  
input: `./benchmark -i com.taobao.hsfcpp.service.nodejs.benchmark -v 1.0.0 -f ping -n 1000000 -c 5` * 2  
output:  

```
QPS: 16200+
RT: 6.16ms
```

#### hsf `json`序列化复杂对象解析   
input: `./benchmark -i com.taobao.hsfcpp.service.nodejs.benchmark -v 1.0.0 -f parse -n 1000000 -c 5` * 2  
output:  

```
QPS: 13500+
RT: 7.39ms
```

#### hsf `hessian`序列化复杂对象解析  
input: `./benchmark -i com.taobao.hsfcpp.service.nodejs.benchmark -v 1.0.0 -f parse -n 1000000 -c 5` * 2  
output:  

```
QPS: 7800+
RT: 12.79ms
```

#### hsf 无数据，加domain中间件，无错误触发  
input: `./benchmark -i com.taobao.hsfcpp.service.nodejs.benchmark -v 1.0.0 -f noError -n 1000000 -c 5` * 2  
output:  

```
QPS: 13000+
RT: 7.68ms
```

#### hsf 无数据，加domain中间件，触发错误  
input: `./benchmark -i com.taobao.hsfcpp.service.nodejs.benchmark -v 1.0.0 -f asyncError -n 1000000 -c 5`  
output:  

```
QPS: 5295  
RT: 9.44ms
```

### 详细测试报告   
#### http hello world benchmark result  

```js
var http = require('http');
var server = http.createServer(function (req, res) {
  res.end('hello world');
}).listen(8080);                 
```
使用siege keepalive进行测试   

input: `siege -t 100S -c 50 --benchmark http://10.232.102.134:8080/`
output:  

```
siege -t 100S -c 50 --benchmark http://10.232.102.134:8080/
** SIEGE 2.70
** Preparing 50 concurrent users for battle.
The server is now under siege...
Lifting the server siege...      done.
Transactions:         984086 hits
Availability:         100.00 %
Elapsed time:          99.21 secs
Data transferred:        10.32 MB
Response time:            0.01 secs
Transaction rate:      9919.22 trans/sec
Throughput:           0.10 MB/sec
Concurrency:           49.96
Successful transactions:      984086
Failed transactions:             0
Longest transaction:          0.22
Shortest transaction:         0.00
```

input `siege -t 100S -c 100 --benchmark http://10.232.102.134:8080/`
output:  

```
siege -t 100S -c 100 --benchmark http://10.232.102.134:8080/
** SIEGE 2.70
** Preparing 100 concurrent users for battle.
The server is now under siege...
Lifting the server siege...      done.
Transactions:        1078638 hits
Availability:         100.00 %
Elapsed time:          99.35 secs
Data transferred:        11.32 MB
Response time:            0.01 secs
Transaction rate:     10856.95 trans/sec
Throughput:           0.11 MB/sec
Concurrency:           99.93
Successful transactions:     1078638
Failed transactions:             0
Longest transaction:          0.22
Shortest transaction:         0.00
```

server CPU： 100%


### node hsf benchmark result   

服务端被调用方法：  

```js
//无任何处理
var ping = function (res) {
  res.send('echo');
}
//序列化一个复杂对象
var parse = function (res, a, b) {
  //返回一个复杂对象  
  res.send({
    string: 'hello world',
    number: 1024.1,
    boolean: true,
    array: ['hello', 1024.12, true, {foo: 'bar'}, [1, 2, 3]],
    obj: {
      string: 'hello',
      boolean: true,
      array: ['hello', 'world'],
      number: 1024.123,
      obj: {
        foo: 'bar'
      },
    },
  });
}
//使用hsf-domain中间件
var asyncError = function (res) {
  process.nextTick(function () {
    res.send(async);
  });
}
var noError = function (res) {
  res.send('ok');
}
```

#### 开启nohsf选项,使用JSON序列化   

input: `./benchmark -i com.taobao.hsfcpp.service.nodejs.benchmark -v 1.0.0 -f ping -n 1000000 -c 5`
output:   

```
Node-hsf benchmark test at Mon Dec 24 2012 15:00:32 GMT+0800 (CST):
target: com.taobao.hsfcpp.service.nodejs.benchmark:1.0.0, parse(s,1,2)
Number of totaol request: 1000000, CONCURRENT users: 5
Time taken for tests:      72.519   seconds     
Complete requests:         1000000 
Failed requests:           0       
Requests per second:       13789.49 [#/sec]     
Time per request:          3.62     [ms]        
Max response time:         54[ms]  
Total transferred:         72.38    Mbytes      
Total transferred rate:    1021.97  [Kbytes/sec]
Sended transferred:        33.80    Mbytes      
Sended transferred rate:   477.33   [Kbytes/sec]
Received transferred:      38.57    Mbytes      
Received transferred rate: 544.64   [Kbytes/sec Response time distribute:
Response time | Num    | Proportion
0 ~ 5         | 798356 | 79.84%    
5 ~ 10        | 196369 | 19.64%    
10 ~ 20       | 5194   | 0.52%     
20 ~ 30       | 71     | 0.01%     
30 ~ 40       | 0      | 0.00%     
40 ~ 50       | 4      | 0.00%     
50 ~ 80       | 6      | 0.00%    
```

server CPU: 80%. 

input: `./benchmark -i com.taobao.hsfcpp.service.nodejs.benchmark -v 1.0.0 -f ping -n 1000000 -c 5` * 2
output:   

```
Node-hsf benchmark test at Sun Jan 06 2013 11:17:13 GMT+0800 (CST):
target: com.taobao.hsfcpp.service.nodejs.benchmark:1.0.0, ping()
Number of totaol request: 1000000, CONCURRENT users: 5
Time taken for tests:      123.068 seconds     
Complete requests:         1000000
Failed requests:           0      
Requests per second:       8125.59 [#/sec]     
Time per request:          6.15    [ms]        
Max response time:         29[ms] 
Total transferred:         58.07   Mbytes      
Total transferred rate:    483.17  [Kbytes/sec]
Sended transferred:        26.17   Mbytes      
Sended transferred rate:   217.79  [Kbytes/sec]
Received transferred:      31.90   Mbytes      
Received transferred rate: 265.39  [Kbytes/sec Response time distribute:
Response time | Num    | Proportion
0 ~ 5         | 358538 | 35.85%    
5 ~ 10        | 468115 | 46.81%    
10 ~ 20       | 172351 | 17.24%    
20 ~ 30       | 996    | 0.10%    

Node-hsf benchmark test at Sun Jan 06 2013 11:17:13 GMT+0800 (CST):
target: com.taobao.hsfcpp.service.nodejs.benchmark:1.0.0, ping()
Number of totaol request: 1000000, CONCURRENT users: 5
Time taken for tests:      123.408 seconds     
Complete requests:         1000000
Failed requests:           0      
Requests per second:       8103.20 [#/sec]     
Time per request:          6.17    [ms]        
Max response time:         40[ms] 
Total transferred:         58.07   Mbytes      
Total transferred rate:    481.84  [Kbytes/sec]
Sended transferred:        26.17   Mbytes      
Sended transferred rate:   217.19  [Kbytes/sec]
Received transferred:      31.90   Mbytes      
Received transferred rate: 264.66  [Kbytes/sec Response time distribute:
Response time | Num    | Proportion
0 ~ 5         | 358325 | 35.83%    
5 ~ 10        | 465490 | 46.55%    
10 ~ 20       | 175224 | 17.52%    
20 ~ 30       | 918    | 0.09%     
30 ~ 40       | 42     | 0.00%     
40 ~ 50       | 1      | 0.00%    
```

`total QPS: 16200+ [#/sec], time per request: 6.16 ms`  
server CPU: 100%  

#### 包含复杂对象解析的性能测试   
input: `./benchmark -i com.taobao.hsfcpp.service.nodejs.benchmark -v 1.0.0 -f parse -n 1000000 -c 5` * 2   
output:  

```
Node-hsf benchmark test at Sun Jan 06 2013 11:27:21 GMT+0800 (CST):
target: com.taobao.hsfcpp.service.nodejs.benchmark:1.0.0, parse()
Number of totaol request: 1000000, CONCURRENT users: 5
Time taken for tests:      147.92  seconds     
Complete requests:         1000000
Failed requests:           0      
Requests per second:       6760.41 [#/sec]     
Time per request:          7.39    [ms]        
Max response time:         226[ms]
Total transferred:         255.48  Mbytes      
Total transferred rate:    1768.61 [Kbytes/sec]
Sended transferred:        27.13   Mbytes      
Sended transferred rate:   187.80  [Kbytes/sec]
Received transferred:      228.35  Mbytes      
Received transferred rate: 1580.81 [Kbytes/sec Response time distribute:
Response time | Num    | Proportion
0 ~ 5         | 273358 | 27.34%    
5 ~ 10        | 413803 | 41.38%    
10 ~ 20       | 309224 | 30.92%    
20 ~ 30       | 3342   | 0.33%     
30 ~ 40       | 74     | 0.01%     
40 ~ 50       | 59     | 0.01%     
50 ~ 80       | 0      | 0.00%     
80 ~ 100      | 0      | 0.00%     
100 ~ 200     | 0      | 0.00%     
200 ~ 300     | 140    | 0.01% 

Node-hsf benchmark test at Sun Jan 06 2013 11:27:21 GMT+0800 (CST):
target: com.taobao.hsfcpp.service.nodejs.benchmark:1.0.0, parse()
Number of totaol request: 1000000, CONCURRENT users: 5
Time taken for tests:      147.856 seconds     
Complete requests:         1000000
Failed requests:           0      
Requests per second:       6763.34 [#/sec]     
Time per request:          7.39    [ms]        
Max response time:         231[ms]
Total transferred:         255.48  Mbytes      
Total transferred rate:    1769.38 [Kbytes/sec]
Sended transferred:        27.13   Mbytes      
Sended transferred rate:   187.88  [Kbytes/sec]
Received transferred:      228.35  Mbytes      
Received transferred rate: 1581.50 [Kbytes/sec Response time distribute:
Response time | Num    | Proportion
0 ~ 5         | 275380 | 27.54%    
5 ~ 10        | 407790 | 40.78%    
10 ~ 20       | 313803 | 31.38%    
20 ~ 30       | 2817   | 0.28%     
30 ~ 40       | 54     | 0.01%     
40 ~ 50       | 36     | 0.00%     
50 ~ 80       | 0      | 0.00%     
80 ~ 100      | 0      | 0.00%     
100 ~ 200     | 0      | 0.00%     
200 ~ 300     | 120    | 0.01% 
```
`total QPS: 13500+ [#/sec] time per request: 7.39 ms`  
server CPU: 100%  

#### hsf-domain性能   

##### 加domain,无数据，不触发error   

input: `./benchmark -i com.taobao.hsfcpp.service.nodejs.benchmark -v 1.0.0 -f noError -n 1000000 -c 5` * 2  
output:   

```
Node-hsf benchmark test at Mon Jan 07 2013 21:04:51 GMT+0800 (CST):
target: com.taobao.hsfcpp.service.nodejs.benchmark:1.0.0, noError()
Number of totaol request: 1000000, CONCURRENT users: 5
Time taken for tests:      153.493 seconds     
Complete requests:         1000000
Failed requests:           0      
Requests per second:       6514.96 [#/sec]     
Time per request:          7.67    [ms]        
Max response time:         40[ms] 
Total transferred:         59.02   Mbytes      
Total transferred rate:    393.76  [Kbytes/sec]
Sended transferred:        29.04   Mbytes      
Sended transferred rate:   193.71  [Kbytes/sec]
Received transferred:      29.99   Mbytes      
Received transferred rate: 200.06  [Kbytes/sec Response time distribute:
Response time | Num    | Proportion
0 ~ 5         | 251004 | 25.10%    
5 ~ 10        | 419816 | 41.98%    
10 ~ 20       | 325745 | 32.57%    
20 ~ 30       | 3283   | 0.33%     
30 ~ 40       | 143    | 0.01%     
40 ~ 50       | 9      | 0.00%  

Node-hsf benchmark test at Mon Jan 07 2013 21:04:52 GMT+0800 (CST):
target: com.taobao.hsfcpp.service.nodejs.benchmark:1.0.0, noError()
Number of totaol request: 1000000, CONCURRENT users: 5
Time taken for tests:      154.137 seconds     
Complete requests:         1000000
Failed requests:           0      
Requests per second:       6487.73 [#/sec]     
Time per request:          7.70    [ms]        
Max response time:         41[ms] 
Total transferred:         59.02   Mbytes      
Total transferred rate:    392.12  [Kbytes/sec]
Sended transferred:        29.04   Mbytes      
Sended transferred rate:   192.90  [Kbytes/sec]
Received transferred:      29.99   Mbytes      
Received transferred rate: 199.22  [Kbytes/sec Response time distribute:
Response time | Num    | Proportion
0 ~ 5         | 253975 | 25.40%    
5 ~ 10        | 410831 | 41.08%    
10 ~ 20       | 331552 | 33.16%    
20 ~ 30       | 3505   | 0.35%     
30 ~ 40       | 117    | 0.01%     
40 ~ 50       | 20     | 0.00% 
```
`total QPS: 13000+ [#/sec], time per request: 7.68 ms`  


##### 加domain,无数据,触发错误   
input: `./benchmark -i com.taobao.hsfcpp.service.nodejs.benchmark -v 1.0.0 -f asyncError -n 1000000 -c 5`  
output:  

```
Node-hsf benchmark test at Mon Jan 07 2013 21:16:11 GMT+0800 (CST):
target: com.taobao.hsfcpp.service.nodejs.benchmark:1.0.0, asyncError()
Number of totaol request: 1000000, CONCURRENT users: 5
Time taken for tests:      188.852 seconds     
Complete requests:         1000000
Failed requests:           0      
Requests per second:       5295.15 [#/sec]     
Time per request:          9.44    [ms]        
Max response time:         314[ms]
Total transferred:         101.94  Mbytes      
Total transferred rate:    552.74  [Kbytes/sec]
Sended transferred:        31.90   Mbytes      
Sended transferred rate:   172.95  [Kbytes/sec]
Received transferred:      70.04   Mbytes      
Received transferred rate: 379.79  [Kbytes/sec Response time distribute:
Response time | Num    | Proportion
0 ~ 5         | 8183   | 0.82%     
5 ~ 10        | 776126 | 77.61%    
10 ~ 20       | 174946 | 17.49%    
20 ~ 30       | 29374  | 2.94%     
30 ~ 40       | 8807   | 0.88%     
40 ~ 50       | 2299   | 0.23%     
50 ~ 80       | 150    | 0.01%     
80 ~ 100      | 13     | 0.00%     
100 ~ 200     | 61     | 0.01%     
200 ~ 300     | 22     | 0.00%     
300 ~ 500     | 19     | 0.00%
```


#### 不开启nohsf选项，hessian序列化   

input: `./benchmark -i com.taobao.hsfcpp.service.nodejs.benchmark -v 1.0.0 -f ping -n 1000000 -c 5`
output:  

```
Node-hsf benchmark test at Mon Dec 24 2012 15:18:57 GMT+0800 (CST):
target: com.taobao.hsfcpp.service.nodejs.benchmark:1.0.0, ping()
Number of totaol request: 1000000, CONCURRENT users: 5
Time taken for tests:      139.955 seconds     
Complete requests:         1000000
Failed requests:           0      
Requests per second:       7145.15 [#/sec]     
Time per request:          6.99    [ms]        
Max response time:         52[ms] 
Total transferred:         805.87  Mbytes      
Total transferred rate:    5896.29 [Kbytes/sec]
Sended transferred:        326.17  Mbytes      
Sended transferred rate:   2386.49 [Kbytes/sec]
Received transferred:      479.70  Mbytes      
Received transferred rate: 3509.80 [Kbytes/sec Response time distribute:
Response time | Num    | Proportion
0 ~ 5         | 188566 | 18.86%    
5 ~ 10        | 727641 | 72.76%    
10 ~ 20       | 82064  | 8.21%     
20 ~ 30       | 1655   | 0.17%     
30 ~ 40       | 68     | 0.01%     
40 ~ 50       | 2      | 0.00%     
```

input: `./benchmark -i com.taobao.hsfcpp.service.nodejs.benchmark -v 1.0.0 -f ping -n 1000000 -c 5` * 2   
output:  

```
Node-hsf benchmark test at Mon Dec 24 2012 15:15:12 GMT+0800 (CST):
target: com.taobao.hsfcpp.service.nodejs.benchmark:1.0.0, ping()
Number of totaol request: 1000000, CONCURRENT users: 5
Time taken for tests:      255.752 seconds     
Complete requests:         1000000
Failed requests:           0      
Requests per second:       3910.04 [#/sec]     
Time per request:          12.78   [ms]        
Max response time:         222[ms]
Total transferred:         805.87  Mbytes      
Total transferred rate:    3226.62 [Kbytes/sec]
Sended transferred:        326.17  Mbytes      
Sended transferred rate:   1305.96 [Kbytes/sec]
Received transferred:      479.70  Mbytes      
Received transferred rate: 1920.66 [Kbytes/sec Response time distribute:
Response time | Num    | Proportion
0 ~ 5         | 98813  | 9.88%     
5 ~ 10        | 197500 | 19.75%    
10 ~ 20       | 645781 | 64.58%    
20 ~ 30       | 57117  | 5.71%     
30 ~ 40       | 718    | 0.07%     
40 ~ 50       | 61     | 0.01%     
50 ~ 80       | 0      | 0.00%     
80 ~ 100      | 0      | 0.00%     
100 ~ 200     | 0      | 0.00%     
200 ~ 300     | 10     | 0.00%  

Node-hsf benchmark test at Mon Dec 24 2012 15:15:11 GMT+0800 (CST):
target: com.taobao.hsfcpp.service.nodejs.benchmark:1.0.0, ping()
Number of totaol request: 1000000, CONCURRENT users: 5
Time taken for tests:      255.949 seconds     
Complete requests:         1000000
Failed requests:           0      
Requests per second:       3907.03 [#/sec]     
Time per request:          12.79   [ms]        
Max response time:         60[ms] 
Total transferred:         805.87  Mbytes      
Total transferred rate:    3224.13 [Kbytes/sec]
Sended transferred:        326.17  Mbytes      
Sended transferred rate:   1304.95 [Kbytes/sec]
Received transferred:      479.70  Mbytes      
Received transferred rate: 1919.18 [Kbytes/sec Response time distribute:
Response time | Num    | Proportion
0 ~ 5         | 102711 | 10.27%    
5 ~ 10        | 194527 | 19.45%    
10 ~ 20       | 642520 | 64.25%    
20 ~ 30       | 59177  | 5.92%     
30 ~ 40       | 954    | 0.10%     
40 ~ 50       | 100    | 0.01%     
50 ~ 80       | 11     | 0.00%     
```
`total QPS: 7800+ [#/sec]`   
复杂对象的hessian序列化对性能影响较大。   
