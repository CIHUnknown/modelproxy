# diamond-client

[![status](http://toast.corp.taobao.com/task/state/id/3816)](http://toast.corp.taobao.com/task/view/id/3816)
[![build status](http://gitlab-ci.alibaba-inc.com/projects/24/status.png?ref=master)](http://gitlab-ci.alibaba-inc.com/projects/24?ref=master)

Ali Diamond client for Node.js

## Usage

```js
var Diamond = require('diamond-client');
var diamond = Diamond.create({
  host: 'commonconfig.taobao.net:8080', // online: "commonconfig.config-host.taobao.com:8080"
  // refreshInterval: 30000, // 数据刷新时间间隔, 默认是 30000 ms, 30 seconds
  // cacheDir: '/tmp/nodejs-diamond-client-cache', // 数据容错存储目录, 当 server 不可用的时候, 自动加载上次缓存的结果
  // requestTimeout: 5000, // 请求 diamond 的超时时间, 默认 5秒
});

// 监听数据
diamond.on('com.taobao.hsf.redis', 'HSF', function (content) {
  console.log(content); // "172.24.179.55:6379"
}).ready(function () {
  // diamond init ready
});
```

### Error Events

```js
diamond.onError('initError', function (err) {

}).onError('updateServersError', function (err) {

}).onError('syncConfigError', function (err) {

});
```

## Links

Diamond Server 开发联系 @智乔

* diamond wiki 地址：http://baike.corp.taobao.com/index.php/Diamond
* diamond client api：http://baike.corp.taobao.com/index.php/Diamond/api
* diamond ops :
    * 线上: http://ops.jm.taobao.org:9999/diamond-ops/
    * 日常: http://ops.jm.taobao.net/diamond-ops/
* zk 接入参考: http://confluence.taobao.ali.com/pages/viewpage.action?pageId=204471886
* diamond-client 的开发接口: http://baike.corp.taobao.com/index.php/Diamond/api
* Diamond 支持 HTTP 协议获取配置信息: http://baike.corp.taobao.com/index.php/Diamond%E5%8D%8F%E8%AE%AE

configserver 事宜请联系 @超神

## 获取集群地址列表

* 日常/二套/性能 环境

```bash
$ curl "http://commonconfig.taobao.net:8080/diamond-server/diamond"
```

* 预发/线上 环境

```bash
$ curl "http://commonconfig.config-host.taobao.com:8080/diamond-server/diamond"
```

## OPS DEBUG

获取 HSF redis 服务器配置

* dataId: com.taobao.hsf.redis
* group: HSF

```bash
# 日常环境:
$ curl "http://10.232.102.182:8080/diamond-server/config.co?dataId=com.taobao.hsf.redis&group=HSF"

# 预发
$ curl "http://172.23.228.87:8080/diamond-server/config.co?dataId=com.taobao.hsf.redis&group=HSF"

# 生产环境:
$ curl "http://172.24.23.71:8080/diamond-server/config.co?dataId=com.taobao.hsf.redis&group=HSF"
```

## Contacts

* [@苏千](http://work.alibaba-inc.com/work/u/43624)

```bash
$ git summary

 project  : diamond-client
 repo age : 5 hours
 active   : 1 days
 commits  : 3
 files    : 10
 authors  :
     2  苏千                  66.7%
     1  fengmk2                 33.3%
```
